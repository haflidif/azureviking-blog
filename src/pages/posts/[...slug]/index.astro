---
import { getCollection } from 'astro:content';
import type { GetStaticPaths } from 'astro';
import Layout from '@/layouts/Layout.astro';

export const getStaticPaths = (async () => {
  const posts = await getCollection('posts');
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}) satisfies GetStaticPaths;

const { post } = Astro.props;
const { Content } = await post.render();
---

<Layout title={post.data.title} description={post.data.description}>
  <div class="bg-background text-foreground min-h-screen p-8">
    <article>
      <header class="mb-8">
        <a href="/posts" class="text-primary hover:underline mb-4 inline-block">‚Üê Back to posts</a>
        <h1 class="text-4xl font-bold mb-4">{post.data.title}</h1>
        {
          post.data.description && (
            <p class="text-xl text-muted-foreground mb-4">{post.data.description}</p>
          )
        }
        <div class="flex items-center gap-4 text-sm text-muted-foreground">
          <time datetime={post.data.pubDate.toISOString()}>
            {
              post.data.pubDate.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
              })
            }
          </time>
          {post.data.author && <span>by {post.data.author}</span>}
        </div>
        {
          post.data.tags && post.data.tags.length > 0 && (
            <div class="flex gap-2 mt-4">
              {post.data.tags.map((tag) => (
                <span class="text-xs bg-secondary text-secondary-foreground px-2 py-1 rounded">
                  {tag}
                </span>
              ))}
            </div>
          )
        }
      </header>

      <div class="prose prose-lg dark:prose-invert max-w-none">
        <Content />
      </div>
    </article>
  </div>
</Layout>
