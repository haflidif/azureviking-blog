---
import Layout from '@/layouts/Layout.astro';
import PostGrid from '@/components/PostGrid.svelte';
import Breadcrumbs from '@/components/Breadcrumbs.svelte';
import { getReadTime } from '@/lib/utils/readTime';
import { getPublishedPosts, getPostSlug } from '@/lib/utils/posts';
import { SITE } from '@/config';
import { basePath } from '@/lib/utils/basePath';
import { getBreadcrumbSchema } from '@/lib/schemas';

const schema = getBreadcrumbSchema([
  { name: 'Posts', url: new URL('/post', Astro.site).toString() },
]);

const posts = (await getPublishedPosts()).sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const gridPosts = posts.map((post) => ({
  post,
  slug: getPostSlug(post),
  readTime: getReadTime(post.body || ''),
}));
---

<Layout title="Blog Posts" description={SITE.blogDescription} schema={schema}>
  <Breadcrumbs items={[{ name: 'Posts', href: basePath('/post') }]} />

  <div class="mb-8 sm:mb-10">
    <h1
      class="text-2xl sm:text-3xl lg:text-4xl font-black tracking-tight text-foreground leading-[1.1]"
    >
      Blog Posts
    </h1>
    <p class="mt-3 text-sm sm:text-base text-muted-foreground max-w-2xl leading-relaxed">
      {SITE.blogDescription}
    </p>
  </div>

  <PostGrid posts={gridPosts} client:load />
</Layout>
